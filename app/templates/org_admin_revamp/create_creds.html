<!DOCTYPE html>
<html>
<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/materialize.min.css') }}">
    {{ JSGlue.include() }}
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>
<div class="row">
    <div class="col s12 m4 l3">


        <ul id="nav-mobile" class="side-nav fixed">
            <li class="logo" style="text-align: center">
                <img src="{{ org_info.image }}"
                     width="100" height="100">

            </li>
            <li class="bold active" style="text-align: center">Welcome, {{ user['name'] }}</li>
            <li>
                <hr>
            </li>
            <li class=""><a
                    href="{{ url_for('org_admin.dashboard', username=user.username, org_username=org_info.username) }}"
                    class="waves-effect waves-teal">Dashboard</a></li>
            <li class="active no-padding">
                <ul class="collapsible collapsible-accordion">
                    <li class="bold"><a class="collapsible-header waves-effect waves-teal"
                                        href="{{ url_for('org_admin.credentials', username=user.username, org_username=org_info.username) }}">Credentials
                    </a>
                        <div class="collapsible-body">
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="col s12 m8 l9">
        <ul>
            <li>
                <nav class="nav-extended">
                    <div class="nav-wrapper">

                    </div>
                    <div class="nav-content">
                        <span class="nav-title">Create Credentials</span>

                    </div>
                </nav>
            </li>
            <li>
                <hr>
            </li>
            <li>
                <form method="POST">

                    <div class="row">
                        <div class="input-field col s6">
                            <input id="profilename" name="profilename" type="text" class="validate" required>
                            <label for="profilename">Profile Name</label>
                        </div>
                    </div>

                </form>

                <ul class="collapsible">
                    <li>
                        <div class="collapsible-header"><i class="material-icons"
                                                           id="scm_icon">check_box_outline_blank</i>SCM Profile
                            Creation
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="scm_username" name="scm_username" type="text" class="validate"
                                           required>
                                    <label for="scm_username">SCM Username</label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="scm_password" name="scm_password" type="password" class="validate"
                                           required>
                                    <label for="scm_password">SCM Password</label>
                                </div>
                            </div>

                            <button class="btn waves-effect waves-light" onclick="authenticate_scm()"
                                    id="authenticate_scm">Authenticate
                            </button>


                        </div>
                    </li>
                    <li>
                        <div class="collapsible-header"><i class="material-icons" id="build_icon">check_box_outline_blank</i>Build
                            Profile Creation
                        </div>
                        <div class="collapsible-body">

                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="build_server_name" name="build_server_name" type="text"
                                           class="validate"
                                           required>
                                    <label for="build_server_name">Server</label>
                                </div>
                            </div>


                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="build_username" name="build_username" type="text" class="validate"
                                           required>
                                    <label for="username">Username</label>
                                </div>
                            </div>


                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="build_password" name="build_password" type="password"
                                           class="validate" required>
                                    <label for="password">Password</label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="build_token" name="build_token" type="text" class="validate"
                                           required>
                                    <label for="build_token">Token</label>
                                </div>
                            </div>

                            <div class="row">
                                <br>
                                <button class="btn waves-effect waves-light" onclick="authenticate_build()"
                                        id="authenticate_build">Authenticate
                                </button>
                            </div>

                        </div>
                    </li>
                    <li>
                        <div class="collapsible-header"><i class="material-icons" id="deploy_icon">check_box_outline_blank</i>Deploy
                            Profile
                            Creation
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="deploy_server_name" name="deploy_server_name" type="text"
                                           class="validate" required>
                                    <label for="deploy_server_name">Server</label>
                                </div>
                            </div>


                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="deploy_username" name="deploy_username" type="text" class="validate"
                                           required>
                                    <label for="deploy_username">Username</label>
                                </div>
                            </div>


                            <div class="row">
                                <div class="input-field col s6">
                                    <input id="deploy_password" name="deploy_password" type="password"
                                           class="validate" required>
                                    <label for="deploy_password">Password</label>
                                </div>
                            </div>


                            <div class="row">
                                <br>
                                <button class="btn waves-effect waves-light" onclick="authenticate_deploy()"
                                        id="authenticate_deploy">Authenticate
                                </button>
                            </div>
                        </div>
                    </li>
                </ul>
                <div class="row">
                    <br>
                    <button class=" btn waves-effect waves-light" onclick="upload_creds()" id="create_cred">Submit
                        Changes
                    </button>
                </div>


            </li>

        </ul>

    </div>

</div>


<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/materialize.min.js') }}"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('.modal').modal();
    });
</script>

<script type="text/javascript">
    function authenticate_scm() {
        var username = document.getElementById('scm_username').value;
        var password = document.getElementById('scm_password').value;
        $.ajax({
            url: Flask.url_for('org_admin.authenticate_scm'),
            type: 'GET',
            data: {
                'username': username,
                'password': password
            },
            success: function (data) {
                if (data.status == 200) {
                    document.getElementById('scm_username').disabled = true;
                    document.getElementById('scm_password').disabled = true;
                    document.getElementById('authenticate_scm').disabled = true;
                    document.getElementById('authenticate_scm').innerHTML = 'Authenticated';
                    document.getElementById('scm_icon').innerHTML = 'check_box'

                }
                else {
                    alert('Wrong username and password');
                }
            },
            error: function (xhr) {
            }
        })
    }
</script>

<script type="text/javascript">
    function authenticate_build() {
        var username = document.getElementById('build_username').value;
        var password = document.getElementById('build_password').value;
        var build_server_name = document.getElementById('build_server_name').value;
        var build_token = document.getElementById('build_token').value;
        $.ajax({
            url: Flask.url_for('org_admin.authenticate_build'),
            type: 'GET',
            data: {
                'username': username,
                'password': password,
                'server_name': build_server_name,
                'token': build_token
            },
            success: function (data) {
                if (data.status == 200) {
                    document.getElementById('build_server_name').disabled = true;
                    document.getElementById('build_token').disabled = true;
                    document.getElementById('build_username').disabled = true;
                    document.getElementById('build_password').disabled = true;
                    document.getElementById('authenticate_build').disabled = true;
                    document.getElementById('authenticate_build').innerHTML = 'Authenticated';
                    document.getElementById('build_icon').innerHTML = 'check_box'

                }
                else {
                    alert('Wrong Credentials');
                }
            },
            error: function (xhr) {
            }
        })
    }
</script>

<script type="text/javascript">
    function authenticate_deploy() {
        var username = document.getElementById('deploy_username').value;
        var password = document.getElementById('deploy_password').value;
        var server_name = document.getElementById('deploy_server_name').value;

        $.ajax({
            url: Flask.url_for('org_admin.authenticate_deploy'),
            type: 'GET',
            data: {
                'username': username,
                'password': password,
                'server_name': server_name
            },
            success: function (data) {
                if (data.status == 200) {
                    document.getElementById('deploy_server_name').disabled = true;
                    document.getElementById('deploy_username').disabled = true;
                    document.getElementById('deploy_password').disabled = true;
                    document.getElementById('authenticate_deploy').disabled = true;
                    document.getElementById('authenticate_deploy').innerHTML = 'Authenticated';
                    document.getElementById('deploy_icon').innerHTML = 'check_box'

                }
                else {
                    alert('Wrong Credentials');
                }
            },
            error: function (xhr) {
            }
        })
    }
</script>


<script>

    function upload_creds() {
        profile_name = document.getElementById('profilename').value;
        if (profile_name != '') {
            var scm_username = document.getElementById('scm_username');
            var scm_password = document.getElementById('scm_password');
            if (document.getElementById('authenticate_deploy').disabled & document.getElementById('authenticate_scm').disabled &
                document.getElementById('authenticate_build').disabled) {
                $.ajax({
                    url: Flask.url_for('org_admin.upload_creds'),
                    type: 'GET',
                    data: {
                        'admin': '{{ user.username }}',
                        'org_username': '{{ org_info.username }}',
                        'profile_name': profile_name,
                        'scm_username': document.getElementById('scm_username').value,
                        'scm_password': document.getElementById('scm_password').value,
                        'build_username': document.getElementById('build_username').value,
                        'build_password': document.getElementById('build_password').value,
                        'build_token': document.getElementById('build_token').value,
                        'build_server_name': document.getElementById('build_server_name').value,
                        'deploy_username': document.getElementById('deploy_username').value,
                        'deploy_password': document.getElementById('deploy_password').value,
                        'deploy_server_name': document.getElementById('deploy_server_name').value,
                    },
                    success: function (data) {
                        if (data.status == 200) {
                            alert('Credentials Created');
                            window.location.href = data.url
                        }
                        else {
                            alert('Profile Exists, Enter Different Profile Name')
                        }
                    },
                    error: function (xhr) {
                    }

                })
            }
            else {
                alert("Profile Sections Not Complete")
            }
        }
        else {
            alert('Enter Profile Name')
        }
    }

</script>
</body>
</html>